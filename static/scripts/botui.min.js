/*
 * botui 0.3.4
 * A JS library to build the UI for your bot
 * https://botui.org
 *
 * Copyright 2018, Moin Uddin
 * Released under the MIT license.
*/

!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.BotUI=t(e)}):e.BotUI=t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";return function(t,o){function n(e,t,o,n){return"<a class='botui-message-content-link' target='"+(n?"blank":"")+"' href='"+o+"'>"+t+"</a>"}function i(e){console.log("Text before parsing: "+e);var t=e.replace(m.image,"<img class='botui-message-content-image' src='$2' alt='$1' />").replace(m.icon,"<i class='botui-icon botui-message-content-icon fa fa-$1'></i>").replace(m.link,n).replace(m.br,"<br />  ");return console.log("Text after parsing: "+t),t}function s(e,t){var o=document.createElement("script");o.type="text/javascript",o.src=e,t&&(o.onload=t),document.body.appendChild(o)}function c(e){console.log("handling action: "+e),y.action.addMessage&&f.message.human({delay:100,content:e}),y.action.show=!y.action.autoHide}function c(e,t){console.log("handling action with position: "+e+" pos: "+t),y.action.addMessage&&f.message.human({delay:100,content:e,dialogue_position:t}),y.action.show=!y.action.autoHide}function a(e){if(!e.loading&&!e.content)throw Error('BotUI: "content" is required in a non-loading message object.');console.log("_addMessage 1:"+e.content),console.log("_addMessage 1:"+e.human),console.log("_addMessage 1:"+e.position),e.type=e.type||"text",e.visible=!e.delay&&!e.loading,console.log("_addMessage 2:"+y.messages);var t=y.messages.push(e)-1;return console.log("Content: "+e.content),console.log("_addMessage 3..."),new Promise(function(o,n){console.log("Promise..."),setTimeout(function(){console.log("timeout..."),e.delay&&(console.log("_visible..."),e.visible=!0,e.loading&&(e.loading=!1)),console.log("_resolve..."),o(t)},e.delay||0)})}function l(e){return console.log("_checkOpts..."),"string"==typeof e&&(e={content:e}),e||{}}function u(e,t){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}function r(e){if(!e.action&&!e.actionButton&&!e.actionText)throw Error('BotUI: "action" property is required.')}function g(e){return r(e),u({type:"text",cssClass:"",autoHide:!0,addMessage:!0},e),y.action.type=e.type,y.action.cssClass=e.cssClass,y.action.autoHide=e.autoHide,y.action.addMessage=e.addMessage,new Promise(function(t,o){v=t,setTimeout(function(){y.action.show=!0},e.delay||0)})}if(o=o||{},!t)throw Error("BotUI: Container id is required as first argument.");if(!document.getElementById(t))throw Error("BotUI: Element with id #"+t+" does not exist.");if(!e.Vue&&!o.vue)throw Error("BotUI: Vue is required but not found.");var d,h,v,p={debug:!1,fontawesome:!0,searchselect:!0},f={},m={icon:/!\(([^\)]+)\)/gim,image:/!\[(.*?)\]\((.*?)\)/gim,link:/\[([^\[]+)\]\(([^\)]+)\)(\^?)/gim,br:/\s\s/gim};e.Vue=e.Vue||o.vue;for(var b in p)o.hasOwnProperty(b)&&(p[b]=o[b]);e.Promise||Promise||options.promise||s("https://cdn.jsdelivr.net/es6-promise/4.1.0/es6-promise.min.js");var x={template:"<div class=\"botui botui-container\" v-botui-container> <span style=\"display:none\" v-on:click=\"count++\">{{ count }}</span><div class=\"botui-messages-container\"><div v-for=\"msg in messages\" class=\"botui-message\" :class=\"msg.cssClass\" v-botui-scroll><transition name=\"slide-fade\"><div v-if=\"msg.visible\" :class=\"[{human: msg.human, \'botui-message-content\': true}, msg.type]\"><span v-if=\"msg.type == \'text\'\" v-text=\"msg.content\" v-botui-markdown></span> <iframe v-if=\"msg.type == \'embed\'\" :src=\"msg.content\" frameborder=\"0\" allowfullscreen></iframe></div></transition><div v-if=\"msg.visible && msg.human\" class=\"right\"><a v-if=\"msg.human\" @click=\"handle_action_edit(msg.dialogue_position)\"><i class=\"fas fa-edit\" style=\"width: 40px; margin:auto; font-size: 20px;\"></i></a></div><div v-if=\"msg.loading\" class=\"botui-message-content loading\"><i class=\"dot\"></i><i class=\"dot\"></i><i class=\"dot\"></i></div></div></div><div class=\"botui-actions-container\"><transition name=\"slide-fade\"><div v-if=\"action.show\" v-botui-scroll><form v-if=\"action.type == \'text\'\" class=\"botui-actions-text\" @submit.prevent=\"handle_action_text(action.position)\" :class=\"action.cssClass\"><i v-if=\"action.text.icon\" class=\"botui-icon botui-action-text-icon fa\" :class=\"\'fa-\' + action.text.icon\"></i> <input type=\"text\" ref=\"input\" :type=\"action.text.sub_type\" v-model=\"action.text.value\" class=\"botui-actions-text-input\" :placeholder=\"action.text.placeholder\" :size=\"action.text.size\" :value=\" action.text.value\" :class=\"action.text.cssClass\" required v-focus/> <button type=\"submit\" :class=\"{\'botui-actions-buttons-button\': !!action.text.button, \'botui-actions-text-submit\': !action.text.button}\"><i v-if=\"action.text.button && action.text.button.icon\" class=\"botui-icon botui-action-button-icon fa\" :class=\"\'fa-\' + action.text.button.icon\"></i> <span>{{(action.text.button && action.text.button.label) || \'Go\'}}</span></button></form><form v-if=\"action.type == \'select\'\" class=\"botui-actions-select\" @submit.prevent=\"handle_action_select()\" :class=\"action.cssClass\"><div v-if=\"!action.select.multipleselect\" class=\"col-4\"><div class=\"list-group\" id=\"list-tab\" role=\"tablist\"> <a v-for=\"option in action.select.options\" class=\"list-group-item list-group-item-action\" id=\"list-home-list\" data-toggle=\"list\" role=\"tab\" @click=\"action.select.value = option; handle_action_select()\">{{ option.text }}</a></div></div><div v-else-if=\"action.select.multipleselect\" class=\"col-4\"> <a v-for=\"option in action.select.options\" v-model=\"action.select.value\" class=\"list-group-item list-group-item-action\" :class=\"{\'selected\': onList(option, action.select.value)}\" v-on:click=\"count++; action.select.value = addOption(option, action.select.value)\">{{ option.text }}</a></div> <button type=\"submit\" style=\'display:block; width:100px\' class=\"botui-actions-buttons-button botui-actions-text-submit\"> <span>Submit</span></button></form><div v-if=\"action.type == \'button\'\" class=\"botui-actions-buttons\" :class=\"action.cssClass\"> <button type=\"button\" :class=\"button.cssClass\" class=\"botui-actions-buttons-button\" v-for=\"button in action.button.buttons\" @click=\"handle_action_button(button)\" autofocus><i v-if=\"button.icon\" class=\"botui-icon botui-action-button-icon fa\" :class=\"\'fa-\' + button.icon\"></i> {{ button.text }}</button></div><form v-if=\"action.type == \'buttontext\'\" class=\"botui-actions-text\" @submit.prevent=\"handle_action_text(action.position)\" :class=\"action.cssClass\"><i v-if=\"action.text.icon\" class=\"botui-icon botui-action-text-icon fa\" :class=\"\'fa-\' + action.text.icon\"></i> <input type=\"text\" ref=\"input\" :type=\"action.text.sub_type\" v-model=\"action.text.value\" class=\"botui-actions-text-input\" :placeholder=\"action.text.placeholder\" :size=\"action.text.size\" :value=\"action.text.value\" :class=\"action.text.cssClass\" required v-focus/> <button type=\"submit\" :class=\"{\'botui-actions-buttons-button\': !!action.text.button, \'botui-actions-text-submit\': !action.text.button}\"><i v-if=\"action.text.button && action.text.button.icon\" class=\"botui-icon botui-action-button-icon fa\" :class=\"\'fa-\' + action.text.button.icon\"></i> <span>{{(action.text.button && action.text.button.label) || \'Go\'}}</span></button><div class=\"botui-actions-buttons\" :class=\"action.cssClass\"> <button type=\"button\" :class=\"button.cssClass\" class=\"botui-actions-buttons-button\" v-for=\"button in action.button.buttons\" @click=\"handle_action_button(button)\" autofocus><i v-if=\"button.icon\" class=\"botui-icon botui-action-button-icon fa\" :class=\"\'fa-\' + button.icon\"></i> {{button.text}}</button></div></form></div></transition></div></div>",data:function(){return{count:0,activeClass:"selected",action:{text:{size:30,placeholder:"Write here .."},button:{},show:!1,type:"text",autoHide:!0,addMessage:!0},messages:[]}},computed:{isMobile:function(){return e.innerWidth&&e.innerWidth<=768}},methods:{onList:function(e,t){console.log("----ON LIST CHECK----");var o=!1;console.log("This option: "+e.text),console.log("Selected options: ");for(var n=0;n<t.length;n++)console.log("Option: "+t[n].text),e.value==t[n].value&&(o=!0);return console.log(o),o},addOption:function(e,t){console.log("----ADD OPTION CHECK----");var o=-1;console.log("This option: "+e.text),console.log("---SELECTED OPTIONS: ");for(var n=0;n<t.length;n++)console.log("OPT: "+t[n].text),e.value==t[n].value&&(o=n);-1!=o?(console.log("Element exists, trying to remove"),t.splice(o,1)):(console.log("Element does not exist, add"),t.push(e)),console.log("---THIS OPTIONS: ");for(var n=0;n<this.action.select.value.length;n++)console.log("OPT:"+this.action.select.value[n].text),e.value==this.action.select.value[n].value&&console.log("Found the option in selected...");return console.log("---END---"),t},handle_action_button:function(e){console.log("handling action button: "),c(e.text,e.position);var t={type:"button",text:e.text,value:e.value};for(var o in e)e.hasOwnProperty(o)&&"type"!==o&&"text"!==o&&"value"!==o&&(t[o]=e[o]);v(t)},handle_action_edit:function(e){y.action.show=!y.action.autoHide,edit_selection(e)},handle_action_text:function(e){this.action.text.value&&(c(this.action.text.value,e),v({type:"text",value:this.action.text.value}),this.action.text.value="")},handle_action_select:function(){if(this.action.select.searchselect&&!this.action.select.multipleselect){if(console.log("Action select value:"+this.action.select.value),!this.action.select.value.value)return void console.log("Select did not pass in searchselect!");console.log("Object:"+this.action.select.value),console.log("Value:"+this.action.select.value.value),console.log("Text:"+this.action.select.value.text),console.log("Label:"+this.action.select.label),console.log("Sel Label:"+this.action.select.value[this.action.select.label]),console.log(this.action),c(this.action.select.value[this.action.select.label],this.action.select.position),v({type:"text",value:this.action.select.value.value,text:this.action.select.value.text,obj:this.action.select.value})}if(this.action.select.searchselect&&this.action.select.multipleselect){if(!this.action.select.value)return;for(var e=new Array,t=new Array,o=0;o<this.action.select.value.length;o++)e.push(this.action.select.value[o].value),t.push(this.action.select.value[o][this.action.select.label]);console.log(this.action),c(t.join(", "),this.action.select.position),v({type:"text",value:e.join(", "),text:t.join(", "),obj:this.action.select.value})}else{if(!this.action.select.value)return void console.log("Select did not pass in default select!");for(var o=0;o<this.action.select.options.length;o++)this.action.select.options[o].value==this.action.select.value&&(c(this.action.select.options[o].text,this.action.select.position),v({type:"text",value:this.action.select.value,text:this.action.select.options[o].text}))}}}};e.Vue.directive("botui-markdown",function(e,t){console.log("Binding check:"+t.value),"false"!=t.value&&(console.log("Binding true:"+e.textContent),e.innerHTML=i(e.textContent),console.log("After binding parse"))}),e.Vue.directive("botui-scroll",{inserted:function(e){h.scrollTop=h.scrollHeight}}),e.Vue.directive("focus",{inserted:function(e){e.focus()}}),e.Vue.directive("botui-container",{inserted:function(e){h=e}}),d=new e.Vue({components:{"bot-ui":x}}).$mount("#"+t);var y=d.$children[0];return f.message={add:function(e){return console.log("Adding message..."),a(l(e))},bot:function(e){return e=l(e),a(e)},human:function(e){return console.log("Human Adding message..."),e=l(e),e.human=!0,a(e)},get:function(e){return console.log("Getting message: "+y.messages[e]),Promise.resolve(y.messages[e])},remove:function(e){return y.messages.splice(e,1),Promise.resolve()},update:function(e,t){var o=y.messages[e];return console.log("Updating message..."),o.content=t.content,o.visible=!t.loading,o.loading=!!t.loading,Promise.resolve(t.content)},removeAll:function(){return y.messages.splice(0,y.messages.length),Promise.resolve()}},f.action={show:g,hide:function(){return y.action.show=!1,Promise.resolve()},text:function(e){return r(e),y.action.text=e.action,y.action.position=e.action[0].position,console.log(e),console.log(y.action),g(e)},button:function(e){return r(e),e.type="button",y.action.button.buttons=e.action,console.log("*** buttons"),console.log(e.action[0].position),g(e)},select:function(e){if(r(e),e.type="select",e.action.label=e.action.label||"text",e.action.value=e.action.value||"",e.action.searchselect=e.action.searchselect||p.searchselect,e.action.multipleselect=e.action.multipleselect||!1,console.log("passed to JS ----- "),console.log(e.action),e.action.searchselect&&"string"==typeof e.action.value)if(e.action.multipleselect){var t=e.action.value.split(",");e.action.value=new Array;for(var o=0;o<e.action.options.length;o++)for(var n=0;n<t.length;n++)e.action.options[o].value==t[n]&&e.action.value.push(e.action.options[o])}else for(var o=0;o<e.action.options.length;o++)e.action.options[o].value==e.action.value&&(e.action.value=e.action.options[o]);return e.action.searchselect||e.action.options.unshift({value:"",text:e.action.placeholder}),y.action.button=e.action.button,y.action.select=e.action,g(e)},buttontext:function(e){return r(e),e.type="buttontext",y.action.button.buttons=e.actionButton,y.action.text=e.actionText,g(e)}},p.fontawesome&&s("https://use.fontawesome.com/ea731dcb6f.js"),p.searchselect&&s("https://unpkg.com/vue-select@2.4.0/dist/vue-select.js",function(){Vue.component("v-select",VueSelect.VueSelect)}),p.debug&&(f._botApp=d),f}});